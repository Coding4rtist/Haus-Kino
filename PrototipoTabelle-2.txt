CINEMA (
   id        NUMBER(2)    NOT NULL,
   nome      VARCHAR2(20) NOT NULL,
   via       VARCHAR2(30) NOT NULL,
   cap       NUMBER(6)    NOT NULL,
   n_civico  NUMBER(2)    NOT NULL,
   cantone   VARCHAR2(30) NOT NULL,
   n_sale    NUMBER(2)    NOT NULL,  
   CONSTRAINT PK_CINEMA
   PRIMARY KEY (id)
)
STORAGE (INITIAL 5000K)

TELEFONO (
   numero       NUMBER(11) NOT NULL,
   codCinema    NUMBER(2)  NOT NULL, [FK]
   CONSTRAINT PK_TELEFONO
   PRIMARY KEY  (numero)
)
STORAGE (INITIAL 10K)


SALA (
  id          CHAR(1)   NOT NULL,
  superficie  NUMBER(3) NOT NULL,
  capienza    NUMBER(3) NOT NULL,
  codCinema   NUMBER(2) NOT NULL, [FK]
  CONSTRAINT PK_SALA
  PRIMARY KEY (id)
)
STORAGE (INITIAL 10K)  


POSTO (
  id           NUMBER(3)   NOT NULL,
  n_fila       CHAR(1)     NOT NULL,
  n_col        NUMBER(2)   NOT NULL,
  free         NUMBER(0,1) NOT NULL,
  codSala      CHAR(1)     NOT NULL, [FK]
  CONSTRAINT PK_POSTO
  PRIMARY KEY (id)
)
STORAGE (INITIAL 10K)


PALINSESTO (
  id            NUMBER(1) NOT NULL,           
  data          DATE      NOT NULL, 
  ora           DATE?     NOT NULL,
  codCinema     NUMBER(2) NOT NULL,  [FK]
  codSala       CHAR(1)   NOT NULL,  [FK]  
  codFilm       NUMBER(4) NOT NULL,  [FK]
  CONSTRAINT PK_PALINSESTO
  PRIMARY KEY (id)
)
STORAGE (INITIAL 20K)


PROGRAMMAZIONI (
  codPalinsesto NUMBER(1) NOT NULL,    [FK]
  codFilm       NUMBER(4) NOT NULL,    [FK]
  tipo          NUMBER(0,1) NOT NULL,
  CONSTRAINT PK_PROGRAMMAZIONI
  PRIMARY KEY(codPalinsesto,codFilm)
)
STORAGE (INITIAL 10k)

FILM_IN_PROGRAMMAZIONE (
  id         NUMBER(4)    NOT NULL,
  titolo     VARCHAR2(30) NOT NULL,
  recensione CLOB;
  genere     VARCHAR2(20) NOT NULL,
  anno       NUMBER(4)    NOT NULL,
  paese      VARCHAR2(20) NOT NULL,
  durata     NUMBER(3)    NOT NULL,
  d_uscita   DATE;
  distrib    VARCHAR(20)  NOT NULL,
  CONSTRAINT PK_FIP 
  PRIMARY KEY(id)
)
STORAGE (INITIAL 110000K)

ARTISTA (
  nome     VARCHAR2(20) NOT NULL,
  cognome  VARCHAR2(20) NOT NULL,
  eta      NUMBER(2)    NOT NULL,
  attore   VARCHAR(20)  NOT NULL,
  regista  VARCHAR(20)  NOT NULL,
  CONSTRAINT PK_ARTISTA
  PRIMARY KEY(nome,cognome)
)
STORAGE (INITIAL 85K)

CASTING ( 
  codFilm   NUMBER(4)    NOT NULL,      [FK]      
  n_Artista VARCHAR2(20) NOT NULL,      [FK]     
  c_Artista VARCHAR2(20) NOT NULL,      [FK]          
  ruolo     NUMBER(0,1) NOT NULL,
  CONSTRAINT PK_CASTING
  PRIMARY KEY (codFilm,n_Artista,c_Artista)
)
STORAGE (INITIAL 70K)

LOCAZIONI (
  codSala       CHAR(1)   NOT NULL,     [FK]
  codPalinsesto NUMBER(1) NOT NULL,     [FK]
  CONSTRAINT PK_LOCAZIONI
  PRIMARY KEY (codSala,codPalinsesto) 
)
STORAGE (INITIAL 4K)

PRENOTAZIONI (
  id       NUMBER(6)    NOT NULL,
  prezzo   NUMBER(3)    NOT NULL,
  tipo     NUMBER(0,1)  NOT NULL,
  pagato   NUMBER(0,1)  NOT NULL, 
  data     DATE,
  codUser NUMBER (4)   NOT NULL,   [FK]
  CONSTRAINT PK_PREN
  PRIMARY KEY (id)
)
STORAGE (INITIAL 15K)

POSTO_SCELTO (
  id        NUMBER(3)  NOT NULL, 
  n_fila    CHAR(1)    NOT NULL,
  n_col     NUMBER(2)  NOT NULL,
  codSala   CHAR(1)    NOT NULL,  [FK]
  CONSTRAINT PK_PS 
  PRIMARY KEY (id)
)
STORAGE (INITIAL 10K)

UTENTE (
 id         NUMBER(4)     NOT NULL,
 username   VARCHAR2(20)  NOT NULL,
 password   VARCHAR2(20)  NOT NULL,
 email      VARCHAR2(20)  NOT NULL,
 nome       VARCHAR2(20)  NOT NULL,
 cognome    VARCHAR2(20)  NOT NULL,
 CONSTRAINT PK_USER 
 PRIMARY KEY (id)
)
STORAGE (INITIAL 104000K)



ALTER TABLE TELEFONO
ADD CONSTRAINT FK_TEL_CIN FOREIGN KEY codCinema
REFERENCES CINEMA(id)
ON DELETE SET NULL;


ALTER TABLE SALA
ADD CONSTRAINT FK_SALA_CIN FOREIGN KEY codCinema
REFERENCES CINEMA(id)
ON DELETE SET NULL;


ALTER TABLE POSTO
ADD CONSTRAINT FK_SEAT_SALA FOREIGN KEY codSala
REFERENCES SALA(id)
ON DELETE SET NULL;


ALTER TABLE PALINSESTO
ADD CONSTRAINT FK_PAL FOREIGN KEY (codCinema,codSala,codFilm)
REFERENCES CINEMA(id), SALA(id), FILM_IN_PROGRAMMAZIONE(id)
ON DELETE SET NULL;

ALTER TABLE PROGRAMMAZIONI
ADD CONSTRAINT FK_PROG FOREIGN KEY (codPalinsesto,codFilm)
REFERENCES PALINSESTO(id), FILM_IN_PROGRAMMAZIONE(id)
ON DELETE SET NULL;

ALTER TABLE CASTING
ADD CONSTRAINT FK_CAST FOREIGN KEY (n_Artista,c_Artista,codFilm)
REFERENCES ARTISTA(nome,cognome), FILM_IN_PROGRAMMAZIONE(id)
ON DELETE SET NULL;

ALTER TABLE LOCAZIONI
ADD CONSTRAINT FK_LOC FOREIGN KEY (codSala,codPalinsesto)
REFERENCES SALA(id), PALINSESTO(id)
ON DELETE SET NULL;

ALTER TABLE PRENOTAZIONI
ADD CONSTRAINT FK_PREN FOREIGN KEY (codUser)
REFERENCES UTENTE(id)
ON DELETE SET NULL;

ALTER TABLE POSTO_SCELTO
ADD CONSTRAINT FK_PREN FOREIGN KEY (codSala)
REFERENCES SALA(id)
ON DELETE SET NULL;





